{% extends 'base.html' %}

{% block page_title %}Product Inventory{% endblock %}

{% block content %}
<div class="card">
    <div class="header" style="margin-bottom: 1rem; border-bottom: none; gap: 1rem;">
        <form id="product-search-form" method="get" action="{% url 'product_list' %}"
            style="display: flex; gap: 0.5rem; align-items: center;">
            <input type="text" id="product-search-input" name="q" value="{{ query }}"
                placeholder="Search by name, brand, or category..."
                style="padding: 0.5rem; width: 300px;">
            <button type="submit" class="btn" style="padding: 0.4rem 0.6rem;">
                <ion-icon name="search"></ion-icon>
            </button>
        </form>
        <a href="{% url 'product_create' %}" class="btn btn-primary">
            <ion-icon name="add"></ion-icon> Add Product
        </a>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Brand</th>
                    <th>Category</th>
                    <th>Company</th>
                    <th>Tax %</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td style="font-weight: 500;">{{ product.name }}</td>
                    <td>{{ product.brand.name }}</td>
                    <td>{{ product.category.name }}</td>
                    <td>{{ product.company }}</td>
                    <td>{{ product.tax_percentage }}%</td>
                    <td>
                        <a href="{% url 'add_stock' product.pk %}" class="btn"
                            style="padding: 0.25rem 0.5rem; font-size: 0.875rem; background: var(--secondary); margin-right: 0.5rem; color: white;">+
                            Stock</a>
                        <a href="{% url 'product_edit' product.pk %}" class="btn"
                            style="padding: 0.25rem 0.5rem; font-size: 0.875rem; color: var(--primary);">Edit</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center" style="padding: 2rem; color: var(--text-muted);">
                        No products found. Click "Add Product" to create one.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script>
    (function () {
        const form = document.getElementById('product-search-form');
        const input = document.getElementById('product-search-input');
        if (!form || !input) return;

        let timer;
        input.addEventListener('input', function () {
            clearTimeout(timer);
            timer = setTimeout(() => {
                const value = input.value.trim();
                if (value.length >= 3 || value.length === 0) {
                    form.submit();
                }
            }, 400);
        });
    })();
</script>
{% endblock %}
